<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <title>Laporan Penjualan - Kasir Mini</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; }
    .card { border-radius: 10px; }
  </style>
</head>
<body>
<div class="container my-4">
  <h4 class="mb-4">ðŸ“ˆ Laporan Penjualan</h4>

  <div class="card p-3 mb-3">
    <h5>Filter Laporan</h5>
    <div class="row g-2">
      <div class="col-md-4">
        <input id="from" type="date" class="form-control">
      </div>
      <div class="col-md-4">
        <input id="to" type="date" class="form-control">
      </div>
      <div class="col-md-4">
        <button id="loadBtn" class="btn btn-primary w-100">Tampilkan</button>
      </div>
    </div>
  </div>

  <div class="card p-3 mb-3">
    <h5>Total Penjualan</h5>
    <div id="salesSummary" class="fw-bold text-success">Belum ada data</div>
  </div>

  <div class="card p-3">
    <h5>Produk Terlaris</h5>
    <table class="table table-bordered mt-2">
      <thead class="table-light"><tr><th>No</th><th>Produk</th><th>Jumlah Terjual</th></tr></thead>
      <tbody id="topBody"></tbody>
    </table>
  </div>
</div>

<script src="assets/js/api.js"></script>
<script>
document.getElementById('loadBtn').onclick = async () => {
  const from = document.getElementById('from').value;
  const to = document.getElementById('to').value;
  try {
    // Ambil total penjualan
    const sales = await apiFetch(`/reports/sales?from=${from}&to=${to}`);
    document.getElementById('salesSummary').innerText = 
      `Total Transaksi: ${sales.total_transaksi || 0} | Total Penjualan: Rp ${Number(sales.total_penjualan || 0).toLocaleString()}`;

    // Ambil produk terlaris
    const top = await apiFetch(`/reports/top-products?from=${from}&to=${to}`);
    const tbody = document.getElementById('topBody');
    tbody.innerHTML = top.length ? top.map((p,i)=>
      `<tr><td>${i+1}</td><td>${p.nama_product}</td><td>${p.total_terjual}</td></tr>`
    ).join('') : `<tr><td colspan="3" class="text-center">Tidak ada data</td></tr>`;
  } catch(e) {
    alert('Gagal memuat laporan');
  }
};
</script>
</body>
</html>
